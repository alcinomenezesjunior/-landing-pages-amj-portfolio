/*** =================================================================* SCRIPT UNIFICADO v1.1 (Refatorado por Ajudante de Programação)* =================================================================* v1.1: Corrige um 'SyntaxError' (missing '}') na função initCountdown.*/document.addEventListener('DOMContentLoaded', () => {const $ = (s, c = document) => c.querySelector(s);const $$ = (s, c = document) => [...c.querySelectorAll(s)];let formSubmitted = false;let exitPopupShown = false;const leadForm = $('#leadForm');const stickyCta = $('#sticky-cta');const exitPopup = $('#exitPopupChatbot'); const successPopup = $('#successPopup');const agencyPopup = $('#exitPopupAgencia'); const openPopup = (popupEl) => {if (!popupEl) return;popupEl.style.display = 'flex';document.body.style.overflow = 'hidden';};const closePopup = (popupEl) => {if (!popupEl) return;popupEl.style.display = 'none';document.body.style.overflow = '';};let popupsState = {chatbotShown: false,agenciaShown: false};let lastFocusedElement = null;function trapFocus(popup) {const focusableElements = popup.querySelectorAll('a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])');if (focusableElements.length === 0) return;const firstElement = focusableElements[0];const lastElement = focusableElements[focusableElements.length - 1];firstElement.focus();const handleTabKey = (e) => {if (e.key === 'Tab') {if (e.shiftKey && document.activeElement === firstElement) {e.preventDefault();lastElement.focus();} else if (!e.shiftKey && document.activeElement === lastElement) {e.preventDefault();firstElement.focus();}}};popup.addEventListener('keydown', handleTabKey);popup._focusTrapHandler = handleTabKey;}function removeFocusTrap(popup) {if (popup && popup._focusTrapHandler) {popup.removeEventListener('keydown', popup._focusTrapHandler);delete popup._focusTrapHandler;}}window.closePopup = function(popupId) {const popup = document.getElementById(popupId);if (popup) {popup.classList.remove('active');popup.classList.remove('show');popup.style.display = 'none';document.body.style.overflow = '';removeFocusTrap(popup);if (lastFocusedElement) {lastFocusedElement.focus();lastFocusedElement = null;}}};function showChatbotPopup() {if (popupsState.chatbotShown) return;const popup = document.getElementById('exitPopupChatbot');if (popup) {lastFocusedElement = document.activeElement;popup.classList.add('active');popup.classList.add('show');popup.style.display = 'flex';document.body.style.overflow = 'hidden';popupsState.chatbotShown = true;sessionStorage.setItem('chatbotPopupShown', 'true');trapFocus(popup);}}window.showAgencyPopup = function() {window.closePopup('exitPopupChatbot');const popup = document.getElementById('exitPopupAgencia');if (popup) {if (!lastFocusedElement) {lastFocusedElement = document.activeElement;}popup.classList.add('active');popup.classList.add('show');popup.style.display = 'flex';document.body.style.overflow = 'hidden';popupsState.agenciaShown = true;trapFocus(popup);}};window.scrollToPlans = function() {const planosSection = document.querySelector('#planos');if (planosSection) {planosSection.scrollIntoView({ behavior: 'smooth', block: 'start' });}};let exitIntentTriggered = false;window.trackWhatsAppDemo = (event) => {if (typeof gtag !== 'undefined') {gtag('event', 'click', {'event_category': 'Demo','event_label': 'WhatsApp Bot Test','value': 1});}return true;};const getDeviceType = () => {const w = Math.min(window.screen.width, window.innerWidth);return w < 600 ? 'mobile' : w < 1024 ? 'tablet' : 'desktop';};const getBrowser = () => {const ua = navigator.userAgent;if (/Chrome/i.test(ua) && !/Edge|OPR/i.test(ua)) return 'Chrome';if (/Safari/i.test(ua) && !/Chrome/i.test(ua)) return 'Safari';if (/Firefox/i.test(ua)) return 'Firefox';if (/Edg/i.test(ua)) return 'Edge';return 'Other';};const getOS = () => {const ua = navigator.userAgent;if (/Windows/i.test(ua)) return 'Windows';if (/Mac OS X/i.test(ua)) return 'macOS';if (/Android/i.test(ua)) return 'Android';if (/iPhone|iPad|iOS/i.test(ua)) return 'iOS';return 'Other';};/*** Módulo: Sticky CTA (Mobile)* Mostra um CTA fixo no fundo após o utilizador fazer scroll.*/function initStickyCta() {if (!stickyCta || window.innerWidth > 768) {return;}let shown = false;window.addEventListener('scroll', () => {if (!shown && window.scrollY > 800) {stickyCta.style.display = 'block';shown = true;}}, { passive: true }); }/*** Módulo: Contador Regressivo* Inicia o contador da oferta "Black November".*/function initCountdown() {const timerWrap = $('.timer');if (!timerWrap) return;const dd = $('#dd'), hh = $('#hh'), mm = $('#mm'), ss = $('#ss');if (!dd || !hh || !mm || !ss) return;const deadlineStr = timerWrap.getAttribute('data-deadline');if (!deadlineStr) {[dd, hh, mm, ss].forEach(el => el.textContent = '00');return;}const targetTime = new Date(deadlineStr + 'Z').getTime();let timerId = null;function lockOfferUI() {const sec = $('#pioneiros');if (sec) {sec.classList.add('is-closed');const title = sec.querySelector('.h2');if (title) title.textContent = 'Oferta encerrada';const btn = sec.querySelector('.btn');if (btn) btn.style.display = 'none';}[dd, hh, mm, ss].forEach(el => el.textContent = '00');}function tick() {const now = Date.now();const diffSeconds = Math.floor((targetTime - now) / 1000);if (diffSeconds <= 0) {lockOfferUI();if (timerId) clearInterval(timerId);return;}const days = Math.floor(diffSeconds / 86400);const hours = Math.floor((diffSeconds % 86400) / 3600);const minutes = Math.floor((diffSeconds % 3600) / 60);const seconds = diffSeconds % 60;dd.textContent = String(days).padStart(2, '0');hh.textContent = String(hours).padStart(2, '0');mm.textContent = String(minutes).padStart(2, '0');ss.textContent = String(seconds).padStart(2, '0');}tick(); timerId = setInterval(tick, 1000); }/*** Módulo: Scroll Suave* Faz o scroll para âncoras (links com #) de forma suave.*/function initSmoothScroll() {$$('a[href^="#"]').forEach(anchor => {anchor.addEventListener('click', function(e) {const href = this.getAttribute('href');if (href === '#' || href === '#top') {e.preventDefault();window.scrollTo({ top: 0, behavior: 'smooth' });return;}try {const target = $(href);if (target) {e.preventDefault();const offsetTop = target.getBoundingClientRect().top + window.pageYOffset - 80;window.scrollTo({ top: offsetTop, behavior: 'smooth' });}} catch (err) {}});});}/*** Módulo: Popups* Controla a lógica de abrir/fechar todos os popups.*/function initPopups() {$$('.exit-popup__overlay, .exit-popup__close, .popup__overlay, .popup__close').forEach(el => {el.addEventListener('click', (e) => {const popup = e.target.closest('.exit-popup, .popup');if (popup) closePopup(popup);});});document.addEventListener('keydown', (e) => {if (e.key === 'Escape') {closePopup(exitPopup);closePopup(successPopup);closePopup(agencyPopup);}});if (exitPopup) {document.addEventListener('mouseleave', (e) => {if (e.clientY <= 0 && !exitPopupShown && !formSubmitted && window.innerWidth > 768) {openPopup(exitPopup);exitPopupShown = true;}});$('#exitPopupPrimary')?.addEventListener('click', (e) => {e.preventDefault();closePopup(exitPopup);$('a[href="#formulario"]')?.click();});$('#exitPopupSecondary')?.addEventListener('click', (e) => {e.preventDefault();closePopup(exitPopup);openPopup(agencyPopup);});}if (successPopup) {$('#successPopupSecondaryClose')?.addEventListener('click', () => closePopup(successPopup));}if (agencyPopup) {$('#agencyDismiss')?.addEventListener('click', (e) => {e.preventDefault();closePopup(agencyPopup);});}}/*** Módulo: Formulário* Controla a validação e envio do formulário de lead.*/function initForm() {if (!leadForm) return;leadForm.addEventListener('submit', function (e) {e.preventDefault();const btn = $('button[type="submit"]', leadForm);const btnTxt = btn ? btn.innerHTML : '';if (!leadForm.checkValidity()) {leadForm.reportValidity();return;}if (btn) {btn.disabled = true;btn.innerHTML = '<i class="ri-loader-4-line"></i> Enviando...';}const wa = $('#whatsapp', leadForm); if (wa) wa.value = wa.value.replace(/[^\d]/g,'').slice(0,12);const ig = $('#instagram', leadForm); if (ig) ig.value = ig.value.replace(/[@\s]/g,'').toLowerCase();const usa = $('input[name="usa_automacao"]:checked', leadForm)?.value || '';const inv = $('#investimento_ferramentas', leadForm)?.value || '';const des = $('#desafio_principal', leadForm)?.value?.trim() || '';const payload = {nome: $('#nome', leadForm)?.value || '',email: $('#email', leadForm)?.value || '',whatsapp: $('#whatsapp', leadForm)?.value || '',instagram: $('#instagram', leadForm)?.value || '',origem: $('input[name="origem"]', leadForm)?.value || 'chatbot-estetica',usa_automacao: usa,investimento_ferramentas: inv,desafio_principal: des,timestamp: new Date().toISOString(),url_origem: location.href,url_referrer: document.referrer || 'Direto',tipo_dispositivo: getDeviceType(), navegador: getBrowser(), sistema_operacional: getOS(),resolucao_tela: `${screen.width}x${screen.height}`, idioma_navegador: navigator.language || 'N/A'};openPopup(successPopup);formSubmitted = true; try {if (window.dataLayer) {window.dataLayer.push({event: 'form_submission',form_name: 'chatbot-estetica-lead',usa_automacao: usa,investimento_ferramentas: inv});}} catch(_) {}const url = 'https:let done = false;try {if (navigator.sendBeacon) {done = navigator.sendBeacon(url, new Blob([JSON.stringify(payload)], {type:'application/json'}));}} catch(_) {}if (!done) {try {fetch(url, {method: 'POST',mode: 'no-cors',keepalive: true,headers: { 'Content-Type': 'text/plain' }, body: JSON.stringify(payload),cache: 'no-store',referrerPolicy: 'no-referrer'});done = true;} catch(_) {}}setTimeout(() => {try { leadForm.reset(); } catch(_) {}if (btn) {btn.disabled = false;btn.innerHTML = btnTxt || 'Enviar Candidatura';}}, 800);});}initSmoothScroll();initForm();initStickyCta();initCountdown();initPopups(); }); (function(){if (typeof window === 'undefined') return;var isMobile = (window.innerWidth || 1024) <= 768;if (!isMobile) return;var hasShown = (sessionStorage.getItem('exit_shown') === '1');var markShown = function(){ hasShown = true; try{ sessionStorage.setItem('exit_shown','1'); }catch(e){} };var _openPopup = function(el){if (!el) return;if (typeof window.showChatbotPopup === 'function') {window.showChatbotPopup();} else {el.style.display = 'flex';document.body.style.overflow = 'hidden';}};var isAnyPopupOpen = function(){var open = document.querySelector('.popup.active, .popup.show, .exit-popup[style*="display: flex"]');return !!open;};var showExit = function(){if (hasShown || isAnyPopupOpen()) return;var el = document.getElementById('exitPopupChatbot');if (!el) return;_openPopup(el);markShown();};var onReady = function(fn){if (document.readyState === 'complete' || document.readyState === 'interactive') { fn(); }else { document.addEventListener('DOMContentLoaded', fn, { once: true }); }};onReady(function(){var EXIT_IDLE_MS = 20000;var idleTimer;var resetIdle = function(){clearTimeout(idleTimer);idleTimer = setTimeout(showExit, EXIT_IDLE_MS);};['touchstart','scroll','keydown','mousemove'].forEach(function(evt){window.addEventListener(evt, resetIdle, { passive: true });});resetIdle();var lastY = window.scrollY || 0;window.addEventListener('scroll', function(){var y = window.scrollY || 0;var goingUpFast = (lastY - y) > 80;var nearTop = y < 120;if (goingUpFast && nearTop) showExit();lastY = y;}, { passive: true });try{history.pushState({ amjGuard: 1 }, '');window.addEventListener('popstate', function(){if (!hasShown && !isAnyPopupOpen()){showExit();try{ history.pushState({ amjGuard: 1 }, ''); }catch(e){}}});}catch(e){  }});})();