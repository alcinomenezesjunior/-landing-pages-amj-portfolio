(function(){'use strict';const $=(sel,ctx=document)=>ctx.querySelector(sel);const $$=(sel,ctx=document)=>Array.from(ctx.querySelectorAll(sel));document.addEventListener('DOMContentLoaded',()=>{smoothScroll();formValidation();initCountdown();initWhatsAppUTM();initExitIntent();initGTMTracking();initCertLightbox();});function smoothScroll(){$$('a[href^="#"]').forEach(a=>{a.addEventListener('click',e=>{const id=a.getAttribute('href');const el=id&&id.length>1 ? $(id): null;if(el){e.preventDefault();el.scrollIntoView({behavior: 'smooth',block: 'start'});}});});}function formValidation(){const form=$('#leadForm');if(!form)return;form.addEventListener('submit',(e)=>{let ok=true;$$('input[required],select[required]',form).forEach(el=>{const invalid=(el.type==='checkbox'&&!el.checked)||(!el.value&&el.type!=='checkbox');el.classList.toggle('is-invalid',invalid);if(invalid)ok=false;});if(!ok){e.preventDefault();pushToDataLayer({event: 'form_validation_error',form_name: 'leadForm'});}else{pushToDataLayer({event: 'form_submit_success',form_name: 'leadForm',lead_source: 'trafego_pago_estetica'});}});form.addEventListener('input',(e)=>{const t=e.target;if(t.classList.contains('is-invalid')&&(t.value||(t.type==='checkbox'&&t.checked))){t.classList.remove('is-invalid');}});}function initCountdown(){const dd=document.querySelector('#dd'),hh=document.querySelector('#hh'),mm=document.querySelector('#mm'),ss=document.querySelector('#ss');if(!dd||!hh||!mm||!ss)return;const lisbonNow=()=>new Date(new Date().toLocaleString('en-US',{timeZone: 'Europe/Lisbon'}));const target=new Date(Date.UTC(2025,10,30,23,59,59));const heading=document.querySelector('#urgencia h2');const ofertaBtn=document.querySelector('#oferta .btn');let ended=false;function renderEndedState(){if(ended)return;ended=true;dd.textContent=hh.textContent=mm.textContent=ss.textContent='00';if(heading)heading.textContent='Oferta encerrada';if(ofertaBtn){ofertaBtn.textContent='Oferta encerrada';ofertaBtn.setAttribute('aria-disabled','true');ofertaBtn.style.pointerEvents='none';ofertaBtn.style.filter='grayscale(1)';ofertaBtn.style.opacity='0.7';}}function tick(){const now=lisbonNow();let d if f=Math.floor((target.getTime()-now.getTime())/1000);if(d if f<=0){renderEndedState();return;}const d=Math.floor(d if f/86400);d if f %=86400;const h=Math.floor(d if f/3600);d if f %=3600;const m=Math.floor(d if f/60);const s=d if f % 60;dd.textContent=String(d).padStart(2,'0');hh.textContent=String(h).padStart(2,'0');mm.textContent=String(m).padStart(2,'0');ss.textContent=String(s).padStart(2,'0');}tick();const iv=setInterval(()=>{tick();if(ended)clearInterval(iv);},1000);}function initWhatsAppUTM(){const waLinks=$$('.js-wa,.wa-float,a[href*="wa.me"],a[data-cta-type="whatsapp"]');waLinks.forEach(link=>{link.addEventListener('click',(e)=>{const source=link.dataset.waSource||'landing_page';pushToDataLayer({event: 'whatsapp_click',wa_source: source,wa_phone: link.dataset.phone||'+351926698959'});});});}function initExitIntent(){const popup=$('#exitPopup');if(!popup)return;let shown=false;const COOLDOWN=24*60*60*1000;const lastShown=localStorage.getItem('exitPopupShown');if(lastShown&&Date.now()-parseInt(lastShown)<COOLDOWN)return;document.addEventListener('mouseleave',(e)=>{if(shown)return;if(e.clientY<=0){showPopup();}});function showPopup(){shown=true;popup.style.display='flex';localStorage.setItem('exitPopupShown',Date.now().toString());pushToDataLayer({event: 'exit_intent_shown'});}function hidePopup(){popup.style.display='none';}$('.exit-popup__close',popup)?.addEventListener('click',hidePopup);$('.exit-popup__secondary',popup)?.addEventListener('click',hidePopup);$('.exit-popup__overlay',popup)?.addEventListener('click',hidePopup);$$('[data-exit-cta]',popup).forEach(btn=>{btn.addEventListener('click',()=>{pushToDataLayer({event: 'exit_popup_cta_click',cta_type: btn.dataset.exitCta});hidePopup();});});}function initGTMTracking(){$$('[data-cta-type]').forEach(el=>{el.addEventListener('click',()=>{pushToDataLayer({event: 'cta_click',cta_type: el.dataset.ctaType,cta_location: el.closest('section')?.id||'unknown'});});});}function pushToDataLayer(data){window.dataLayer=window.dataLayer||[];window.dataLayer.push(data);}function initCertLightbox(){const modal=$('#img-modal');const modalImg=$('#img-modal-img');if(!modal||!modalImg)return;$$('.cert if icate-lightbox-trigger').forEach(trigger=>{trigger.addEventListener('click',(e)=>{e.preventDefault();const src=trigger.getAttribute('href');modalImg.setAttribute('src',src);modal.style.display='flex';});});modal.addEventListener('click',()=>{modal.style.display='none';modalImg.setAttribute('src','');});}})();